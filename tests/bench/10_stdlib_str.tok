// Benchmark 10: Stdlib Str â€” upper/lower, contains, replace, split
// Measures string manipulation through stdlib closures

st=@"str"

// Part A: upper + lower case conversion loop
n_case=2000000
t0=clock()
last=""
~(i:0..n_case){
  last=st.upper("hello world")
  last=st.lower(last)
}
t1=clock()
pl("[bench] str_case: {n_case} upper+lower pairs in {t1-t0} ms (last={last})")

// Part B: contains + starts_with + ends_with checks
base="the quick brown fox jumps over the lazy dog"
n_search=2000000
t0=clock()
count=0
~(i:0..n_search){
  c1=st.contains(base "fox")
  c2=st.starts_with(base "the")
  c3=st.ends_with(base "dog")
  c1?{count=count+1}
  c2?{count=count+1}
  c3?{count=count+1}
}
t1=clock()
pl("[bench] str_search: {n_search} x3 checks in {t1-t0} ms (count={count})")

// Part C: replace
n_replace=1000000
t0=clock()
last2=""
~(i:0..n_replace){
  last2=st.replace("hello world hello" "hello" "hi")
}
t1=clock()
pl("[bench] str_replace: {n_replace} calls in {t1-t0} ms (last={last2})")

// Part D: split + rejoin via stdlib
n_split=1000000
t0=clock()
last3=""
~(i:0..n_split){
  parts=st.split("a,b,c,d,e" ",")
  last3=join(parts "-")
}
t1=clock()
pl("[bench] str_split: {n_split} split+join in {t1-t0} ms (last={last3})")
